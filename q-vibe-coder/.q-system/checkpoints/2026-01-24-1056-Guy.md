# Checkpoint: 2026-01-24-1056-Guy

**Session started:** ~10:00
**Checkpoint time:** 2026-01-24-1056
**Participant:** Guy

---

## Accomplishments So Far

### Sidebar Restructuring
- Swapped Post button and More menu order (More is now above Post, matching X.com layout)
- Implemented "More" popup menu with click-outside dismiss
- Popup contains: Settings, Bookmarks, Dark Mode, Help, Log out (with divider before Log out)
- Log out styled in red (danger color)
- Added dark mode and collapsed sidebar support for the popup

### Post Compose Modal (new feature)
- Created PostComposeModal.js component (X.com-inspired compose dialog)
- Created PostComposeModal.css with full styling including dark mode
- Modal opens when Post button is clicked (instead of navigating)
- Features: close button, user avatar, audience selector, textarea, media buttons, Post button
- Post button disabled until text is entered
- Close via X button, Escape key, or click-outside overlay

### Audience Selector Dropdown
- Default shows "The Commons" (not "Everyone")
- Click opens "Choose audience" dropdown
- Shows nested tree structure (Option A): communities with courses indented below
- Courses shown with book icons and left border connector line
- Dropdown is scrollable with max-height
- Only shows communities the user has joined (from followedCommunities localStorage)
- Only shows courses the user is enrolled in (from purchasedCourses localStorage)
- Checkmark shows on selected item
- When a course is selected, audience button shows book icon + course title

### Previous Checkpoint Work (from 1029)
- Removed Discover page gradient header card
- Changed "See all courses" links to pill-styled buttons
- Added Post button and More nav item to sidebar
- Removed Settings from main nav (moved to More popup)

---

## Files Changed

**Created:**
- `my-project/code/src/components/PostComposeModal.js` - Compose modal component
- `my-project/code/src/components/PostComposeModal.css` - Compose modal styles

**Modified:**
- `my-project/code/src/components/Sidebar.js` - Added More popup state/refs/click-outside, swapped Post/More order, More opens popup menu, Post opens compose modal, renders PostComposeModal
- `my-project/code/src/components/Sidebar.css` - Added .more-popup-menu styles (light/dark, collapsed sidebar variant)
- `my-project/code/src/components/DiscoverView.js` - Removed gradient header, pill-styled "See all courses" buttons

---

## Key Decisions

| Decision | Rationale |
|----------|-----------|
| More above Post button | Matches X.com sidebar layout |
| Popup appears above More button | Clean UI, doesn't overlap nav items |
| Dark Mode in More popup | Toggle body class directly |
| Post opens modal (not navigate) | X.com behavior - compose overlay |
| Default audience "The Commons" | User requested instead of "Everyone" |
| Nested tree for courses | User approved Option A wireframe |
| Filter by joined feeds only | User requested - only show enrolled |
| purchasedCourses localStorage | Source of truth for enrolled courses |
| followedCommunities localStorage | Source of truth for joined communities |

---

## Current Status

**Working on:** Audience dropdown filtering is complete. Only shows communities user has joined and courses they're enrolled in.

**Complete:**
- Sidebar restructure (More + popup + Post)
- Post compose modal with audience selector
- Nested courses under communities (Option A tree)
- Filtering by user's joined feeds

**Note:** Demo users (demo_alex, demo_guy) don't have purchasedCourses set in localStorage by default, so courses won't appear in the dropdown until they enroll. The communities show correctly from followedCommunities.

---

## Next Steps

- [ ] User may want to test with a user who has purchased courses
- [ ] Potentially wire up the Post button to actually create posts in the selected audience
- [ ] Verify dark mode styling for the compose modal
- [ ] Any further UI refinements from user feedback

---

## Dev Server

Background task `b2cb983` running on localhost:3000/Peerloop-v2
